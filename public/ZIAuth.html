
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ZTAB — Auth</title>
  <link rel="stylesheet" href="style.css">
   <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark" />
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --text: #fff;
      --accent: #4cc9f0;
    }

    body {
      margin: 0;
      background: #0d0d0f;
      color: var(--text);
      font-family: "Orbitron", sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }

    /* FRAME */
    .frameType {
      border: 10px solid #000;
      border-radius: 14px;
      overflow: hidden;
      width: clamp(280px, 92vw, 340px);
      box-shadow: 0 0 25px rgba(0,0,0,0.6);
      position: relative;
    }

    .frameType-inner {
      border: 5px solid transparent;
      border-image: linear-gradient(135deg,#ff6ec4,#7873f5,#4cc9f0,#3ef3a2,#ff6ec4) 1;
      border-radius: 10px;
      background: radial-gradient(120% 100% at 50% 0%, #1e1e1e 0%, #0e0e0e 70%, #111 100%);
      padding: 14px;
      animation: borderShimmer 6s linear infinite;
      position: relative;
      overflow: hidden;
    }
/* ===== BALANCED 3D BEVEL EDGE ===== */
.frameType::before {
  content: "";
  position: absolute;
  inset: 0;
  border-radius: 14px;
  background:
    linear-gradient(150deg,
      rgba(255,255,255,0.18) 0%,
      rgba(76,201,240,0.15) 25%,
      rgba(62,243,162,0.12) 65%,
      rgba(255,110,196,0.15) 100%);
  box-shadow:
    inset 0 0 10px rgba(76,201,240,0.35),
    inset 0 0 16px rgba(255,110,196,0.18),
    0 0 14px rgba(76,201,240,0.25),
    0 2px 6px rgba(0,0,0,0.4);
  mix-blend-mode: screen;
  pointer-events: none;
  z-index: 2;
  transition: filter 0.4s ease, opacity 0.4s ease;
  opacity: 0.9;
}

.frameType:hover::before {
  filter: brightness(1.15) saturate(1.2);
  opacity: 1;
}

   ./* ELECTRIC CHARGE EFFECT */
.frameType::after {
  content: "";
  position: absolute;
  inset: -2px;
  border-radius: 14px;
  pointer-events: none;
  opacity: 0;
  background: conic-gradient(
    from 0deg,
    #00ffff,
    #00ffcc,
    #99ffff,
    #00ffff,
    #00ffcc,
    #00ffff
  );
  filter: blur(8px) brightness(2);
  mix-blend-mode: screen;
  z-index: 3;
  transition: opacity 0.2s ease;
}

.frameType.zapping::after {
  opacity: 1;
  animation: zapSpin 0.8s linear infinite;
}

@keyframes zapSpin {
  from { transform: rotate(0deg); }
  to { transform: rotate(360deg); }
}

    /* HEADER */
    .card-header {
      text-align: center;
      background: #000;
      border-bottom: 2px solid var(--accent);
      font-size: 0.8rem;
      font-weight: 800;
      text-transform: uppercase;
      padding: 5px;
      margin-bottom: 10px;
      z-index: 1;
      position: relative;
    }

    /* ART */
    .card-art {
      border: 2px solid var(--accent);
      border-radius: 8px;
      overflow: hidden;
      background: #222;
      aspect-ratio: 4/3;
      margin-bottom: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      z-index: 1;
    }

    .card-art img { width: 100%; height: 100%; object-fit: cover; }

    /* TOGGLE */
    .type-banner {
      display: flex;
      justify-content: center;
      gap: 10px;
      border: 1.5px solid var(--accent);
      background: #000;
      border-radius: 6px;
      padding: 5px 8px;
      margin-bottom: 12px;
      position: relative;
      z-index: 1;
    }

    .type-banner button {
      font-size: 0.72rem;
      font-weight: 700;
      padding: 5px 10px;
      border-radius: 5px;
      border: none;
      cursor: pointer;
      background: #1a1a1a;
      color: #aaa;
      transition: 0.2s;
    }

    .type-banner button.active {
      background: var(--accent);
      color: #000;
    }

    /* DROPDOWN */
    .dropdown {
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      transform: scaleY(0.92) translateY(-6px);
      transform-origin: top;
      transition: max-height 0.6s ease, opacity 0.6s ease, transform 0.5s ease;
    }

    .dropdown.open {
      max-height: 800px;
      opacity: 1;
      transform: scaleY(1) translateY(0);
      animation: dropdownFadeIn 0.6s ease forwards;
    }

    @keyframes dropdownFadeIn {
      0% { opacity: 0; transform: scaleY(0.92) translateY(-6px); }
      50% { opacity: 0.8; transform: scaleY(1.03) translateY(2px); }
      100% { opacity: 1; transform: scaleY(1) translateY(0); }
    }

    /* FORM */
    form { text-align: center; position: relative; z-index: 1; }

    .form-group { margin-bottom: 8px; }

    .form-group label {
      font-size: 0.65rem;
      text-align: left;
      display: block;
      width: 90%;
      margin: 0 auto 3px;
      color: #bbb;
    }

    .form-group input {
      width: 90%;
      padding: 6px;
      border-radius: 5px;
      border: 1px solid #333;
      background: #0d0d0f;
      color: #fff;
      font-size: 0.72rem;
      transition: border-color 0.2s ease, box-shadow 0.3s ease;
    }

    .form-group input:focus {
      border-color: var(--accent);
      box-shadow: 0 0 6px #4cc9f0;
      outline: none;
    }

    .submit-btn {
      width: 90%;
      padding: 8px;
      background: var(--accent);
      color: #000;
      border: none;
      border-radius: 6px;
      font-weight: 700;
      font-size: 0.8rem;
      cursor: pointer;
      margin-top: 8px;
      transition: background 0.2s ease, box-shadow 0.3s ease;
    }

    .submit-btn:hover {
      background: #6ef0ff;
      box-shadow: 0 0 10px #4cc9f0cc;
    }

    /* META + FOOTER (unchanged) */
    .meta-block {
      border-top: 2px solid transparent;
      border-bottom: 2px solid transparent;
      border-image: linear-gradient(135deg,#ff6ec4,#7873f5,#4cc9f0,#3ef3a2,#ff6ec4) 1;
      background: #000;
      padding: 8px 10px;
      display: flex;
      flex-direction: column;
      gap: 5px;
      font-size: 0.7rem;
      margin-top: 14px;
    }

    .meta-line {
      display: flex;
      align-items: center;
      justify-content: flex-start;
      gap: 6px;
      white-space: nowrap;
      font-size: min(2.8vw, 0.72rem);
      letter-spacing: 0.02em;
    }

    .meta-label { font-weight: 800; text-transform: uppercase; color: #eee; }
    .meta-value { display: inline-block; white-space: nowrap; font-size: 0.45rem; }

    .meta-bottom {
      border-top: 2px solid transparent;
      border-image: linear-gradient(135deg,#ff6ec4,#7873f5,#4cc9f0,#3ef3a2,#ff6ec4) 1;
      background: #111;
      padding: 8px 12px 32px;
      text-align: center;
      color: #ccc;
      font-size: 0.5rem;
      margin-top: 10px;
      position: relative;
    }

    .meta-timestamp {
      font-size: 0.65rem;
      color: #aefcff;
      margin-top: 4px;
      letter-spacing: 0.03em;
      padding: 2px 14px;
      z-index: 0;
      font-weight: 600;
      text-shadow: 0 0 4px #4cc9f0cc, 0 0 8px #4cc9f099;
    }

    .rarity.ZEOE {
      position: absolute;
      right: 10px;
      bottom: 6px;
      font-weight: 800;
      letter-spacing: .02em;
      border: 1px solid rgba(255,255,255,.3);
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.65rem;
      background: conic-gradient(from 0deg,#ff0040,#ffd200,#00ffcc,#00a2ff,#ff4dff,#ff0040);
      background-size: 200% 200%;
      animation: holoShift 6s linear infinite;
      color: #fff;
      text-shadow: 0 0 6px rgba(255,255,255,.4);
    }

    @keyframes holoShift {
      0% { background-position: 0% 50%; }
      100% { background-position: 200% 50%; }
    }
  </style>
</head>
<body>
  <div class="frameType">
    <div class="frameType-inner" id="frameInner">

      <div class="card-header">ZTAB AUTH</div>

      <div class="card-art">
        <img src="zetsu_cover-r22.png" alt="ZTAB Logo" />
      </div>

      <div class="type-banner">
        <button id="signupBtn" class="active">Sign Up</button>
        <button id="loginBtn">Log In</button>
      </div>

      <!-- DROPDOWN SECTION -->
      <div class="dropdown" id="dropdownPanel">

        <!-- ✅ Disable browser’s native validation -->
        <form id="authForm" novalidate>
          <div class="form-group">
            <label>Email</label>
            <input type="email" id="email" />
          </div>

          <div class="form-group">
            <label>Password</label>
            <input type="password" id="password" />
          </div>

          <div class="form-group" id="confirmWrap">
            <label>Confirm Password</label>
            <input type="password" id="confirmPassword" />
          </div>

          <button class="submit-btn" type="submit">Create Account</button>
        </form>

        <div class="meta-block">
          <div class="meta-line">
            <span class="meta-label">SETS -</span>
            <span class="meta-value">Zetsumetsu Infrastructure-2025 Access Nodes</span>
          </div>
          <div class="meta-line">
            <span class="meta-label">TAGS -</span>
            <span class="meta-value">ZTAB-Auth System Access-Verification Layer</span>
          </div>
        </div>

        <div class="meta-bottom">
          ZetsuAuth™ | Zetsumetsu EOe™ | © 2024 Zetsumetsu Corporation™ | Artworqq Kevin Suber
          <div class="meta-timestamp" id="ztab-time"></div>
          <div class="rarity ZEOE">ZEOE</div>
        </div>

      </div>
    </div>
  </div>

<script type="module">
  // === ELEMENT HOOKS ===
  const el = {
    signupBtn: document.getElementById("signupBtn"),
    loginBtn: document.getElementById("loginBtn"),
    confirmWrap: document.getElementById("confirmWrap"),
    confirmInput: document.getElementById("confirmPassword"),
    submitBtn: document.querySelector(".submit-btn"),
    dropdown: document.getElementById("dropdownPanel"),
    frameInner: document.getElementById("frameInner"),
    inputs: document.querySelectorAll("input"),
    form: document.getElementById("authForm"),
    frame: document.querySelector(".frameType"),
    time: document.getElementById("ztab-time"),
  };

  let open = false;

  // === META TEXT AUTO SCALE ===
  document.querySelectorAll(".meta-value").forEach(v => {
    const parentWidth = v.parentElement.offsetWidth;
    if (v.scrollWidth > parentWidth) {
      v.style.transform = `scale(${parentWidth / v.scrollWidth})`;
    }
  });

  // === CLOCK UPDATE ===
  function updateZtabTime() {
    el.time.textContent = `[ ${new Date().toISOString()} ]`;
  }
  updateZtabTime();
  setInterval(updateZtabTime, 1000);

  // === FRAME PULSE EFFECT ===
  function pulseFrame() {
    el.frameInner.classList.remove("pulse");
    void el.frameInner.offsetWidth;
    el.frameInner.classList.add("pulse");
  }

  // === TOGGLE PANEL ===
  function togglePanel(mode) {
    pulseFrame();

    const active = mode === "signup" ? el.signupBtn : el.loginBtn;
    const inactive = mode === "signup" ? el.loginBtn : el.signupBtn;

    if (open && active.classList.contains("active")) {
      el.dropdown.classList.remove("open");
      active.classList.remove("active");
      open = false;
      return;
    }

    el.dropdown.classList.add("open");
    open = true;
    active.classList.add("active");
    inactive.classList.remove("active");

    // toggle confirm visibility
    if (mode === "signup") {
      el.confirmWrap.style.display = "block";
      el.submitBtn.textContent = "Create Account";
    } else {
      el.confirmWrap.style.display = "none";
      el.submitBtn.textContent = "Log In";
    }
  }

  el.signupBtn.onclick = () => togglePanel("signup");
  el.loginBtn.onclick = () => togglePanel("login");

  // === INPUT ACTIVITY FEEDBACK ===
  el.inputs.forEach(i => {
    i.addEventListener("focus", pulseFrame);
    i.addEventListener("input", pulseFrame);
  });

  // === FORM SUBMIT ===
  el.form.addEventListener("submit", async e => {
    e.preventDefault();
    pulseFrame();

    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value.trim();
    const confirm = el.confirmInput.value.trim();
    const isSignup = el.signupBtn.classList.contains("active");

    // === CUSTOM VALIDATION ===
    if (!email) {
      el.submitBtn.textContent = "Email Required";
      setTimeout(() => (el.submitBtn.textContent = isSignup ? "Create Account" : "Log In"), 1500);
      return;
    }
    if (!password) {
      el.submitBtn.textContent = "Password Required";
      setTimeout(() => (el.submitBtn.textContent = isSignup ? "Create Account" : "Log In"), 1500);
      return;
    }
    if (isSignup) {
      if (!confirm) {
        el.submitBtn.textContent = "Confirm Password";
        setTimeout(() => (el.submitBtn.textContent = "Create Account"), 1500);
        return;
      }
      if (password !== confirm) {
        el.submitBtn.textContent = "Passwords Don't Match";
        setTimeout(() => (el.submitBtn.textContent = "Create Account"), 1500);
        return;
      }
    }

    // === SEND ===
    const originalText = el.submitBtn.textContent;
    el.submitBtn.disabled = true;
    el.submitBtn.textContent = "Charging ⚡";
    el.frame.classList.add("zapping");

    try {
      const mode = isSignup ? "signup" : "login";
      const device_id = `${navigator.platform}-${navigator.userAgent}`;
      const timestamp = new Date().toISOString();

      const res = await fetch("/.netlify/functions/encode", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          email,
          password,
          display_name: email.split("@")[0],
          mode,
          device_id,
          time: timestamp
        }),
      });

      const data = await res.json();
      console.log("ZTAB response:", data);

      if (!res.ok) {
        el.submitBtn.textContent = "Error ✕";
        console.error("Error:", data.error || "Unknown error");
        return;
      }

      if (data.session?.token) {
        sessionStorage.setItem("ztab_token", data.session.token);
      }

      if (data.message?.includes("Signup")) {
        el.submitBtn.textContent = "Account Created ✓";
      } else if (data.message?.includes("Login")) {
        el.submitBtn.textContent = "Access Granted ✓";
      } else {
        el.submitBtn.textContent = "Done ✓";
      }

      pulseFrame();

      setTimeout(() => {
        el.dropdown.classList.remove("open");
        el.signupBtn.classList.remove("active");
        el.loginBtn.classList.remove("active");
        open = false;
        el.form.reset();
      }, 1000);

    } catch (err) {
      console.error("Request failed:", err);
      el.submitBtn.textContent = "Server Error ✕";
    } finally {
      el.frame.classList.remove("zapping");
      setTimeout(() => {
        if (!el.submitBtn.textContent.includes("✓")) {
          el.submitBtn.textContent = originalText;
        }
        el.submitBtn.disabled = false;
      }, 1800);
    }
  });
</script>
</body>
</html>
